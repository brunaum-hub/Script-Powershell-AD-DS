Import-Module ActiveDirectory

# Domínio e OUs
$dominio = "seudominio.local"
$ouUsuarios = "OU=Usuarios,DC=seudominio,DC=local"
$ouGrupos = "OU=Grupos,DC=seudominio,DC=local"

# Setores
$setores = @("TI", "Equipamentos", "Logistica", "Producao", "Pessoal", "Administrativo")

# Listas simples de nomes para gerar nomes aleatórios
$primeirosNomes = @("Lucas", "Mariana", "Felipe", "Amanda", "Bruno", "Isabela", "Rafael", "Julia", "Thiago", "Camila")
$sobrenomes = @("Silva", "Souza", "Oliveira", "Costa", "Pereira", "Almeida", "Martins", "Lima", "Barbosa", "Ribeiro")

# Criar grupos se não existirem
foreach ($grupo in $setores) {
    if (-not (Get-ADGroup -Filter { Name -eq $grupo })) {
        Write-Host "Criando grupo: $grupo"
        New-ADGroup -Name $grupo -GroupScope Global -GroupCategory Security -Path $ouGrupos
    }
}

$matricula = 1

foreach ($setor in $setores) {
    for ($i=1; $i -le 5; $i++) {
        $samAccountName = "user" + "{0:D4}" -f $matricula

        # Gerar nome aleatório
        $nome = $primeirosNomes | Get-Random
        $sobrenome = $sobrenomes | Get-Random
        $nomeCompleto = "$nome $sobrenome"

        $senha = ConvertTo-SecureString "SenhaTemp123!" -AsPlainText -Force

        # Cria usuário se não existir
        if (-not (Get-ADUser -Filter { SamAccountName -eq $samAccountName })) {
            Write-Host "Criando usuário: $nomeCompleto ($samAccountName) no setor $setor"

            New-ADUser `
                -Name $nomeCompleto `
                -SamAccountName $samAccountName `
                -UserPrincipalName "$samAccountName@$dominio" `
                -AccountPassword $senha `
                -Enabled $true `
                -PasswordNeverExpires $true `
                -Path $ouUsuarios `
                -DisplayName $nomeCompleto `
                -GivenName $nome `
                -Surname $sobrenome `
                -Description $setor `
                -ChangePasswordAtLogon $true
        }

        # Adiciona usuário ao grupo do setor
        Add-ADGroupMember -Identity $setor -Members $samAccountName
        Write-Host "Adicionado $samAccountName ao grupo $setor"

        $matricula++
    }
}

